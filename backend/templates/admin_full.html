<!doctype html><html><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Admin ‚Äî Tullman.ai</title>
<style>
:root{--bg:#0b0b0c;--ink:#e8e8ea;--muted:#a9abb3;--card:#141416;--line:#232329;--ok:#3ccf91;--bad:#ef476f;--btn:#19191c}
html,body{background:var(--bg);color:var(--ink);font:16px/1.5 system-ui,Segoe UI,Roboto,Helvetica,Arial;margin:0}
.wrap{max-width:1100px;margin:24px auto;padding:0 16px}
.h{font-weight:800;font-size:20px;margin:10px 0}
.card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:16px;margin:16px 0}
.lab{color:var(--muted);font-size:14px;margin:6px 0}
textarea,input[type=text]{width:100%;background:#0d0d0f;color:var(--ink);border:1px solid var(--line);border-radius:10px;padding:10px;font:15px/1.4 ui-monospace,Menlo,Consolas,monospace}
.btn{display:inline-block;cursor:pointer;border-radius:12px;border:1px solid #2a2a31;background:var(--btn);color:var(--ink);padding:10px 14px;font-weight:700;margin-right:8px}
.btn.ok{border-color:#1e644b;background:#0f3225}
.btn.bad{border-color:#612030;background:#2a121a}
.row{display:flex;gap:12px;flex-wrap:wrap;align-items:center;margin:8px 0}
.status{color:var(--muted);font-size:14px;margin-left:8px}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
</style></head><body><div class="wrap">
<h2>Admin ‚Äî Tullman.ai</h2>
<div class="row">
  <button id="rebuildTop" class="btn ok">üîÅ Rebuild Tuner</button>
  <button id="promoteIdx" class="btn">‚¨ÜÔ∏è Promote to Production</button>
  <span id="prodInfo" class="status">prod index: ‚Ä¶</span><span id="msgTop" class="status"></span>
</div>

<div class="grid">
  <div class="card">
    <div class="h">Rules (Voiceprint)</div>
    <div class="lab">Edit staging rules. Promote when ready.</div>
    <textarea id="rulesBox" rows="12" placeholder="Voiceprint‚Ä¶"></textarea>
    <div class="row"><button id="rulesSave" class="btn ok">Save (Replace)</button>
      <button id="rulesAppend" class="btn">Save (Append)</button><span id="rulesMsg" class="status"></span></div>
    <div class="lab">Path: <span id="rulesPath" class="status"></span></div>
  </div>

  <div class="card">
    <div class="h">Examples (Q&A)</div>
    <div class="lab">Blocks of <code>Q:</code> then <code>A:</code>, blank line between.</div>
    <textarea id="qaBox" rows="12" placeholder="Q: ‚Ä¶&#10;A: ‚Ä¶&#10;&#10;Q: ‚Ä¶&#10;A: ‚Ä¶"></textarea>
    <div class="row"><button id="qaSave" class="btn ok">Save Q&A</button>
      <button id="qaRestore" class="btn">‚Ü©Ô∏é Restore from Prod Index</button><span id="qaMsg" class="status"></span></div>
  </div>
</div>

<div class="card">
  <div class="h">Test & Tuning</div>
  <input id="ttPrompt" type="text" placeholder="Ask a question‚Ä¶ (Enter to send)"/>
  <div class="row"><button id="ttAsk" class="btn ok">Ask</button><span id="ttMsg" class="status"></span></div>
  <div class="lab">System answer (editable)</div>
  <textarea id="ttAnswer" rows="8" placeholder="Answer will appear here‚Ä¶"></textarea>
  <div class="row"><button id="ttAccept" class="btn ok">‚úÖ Accept (save)</button><button id="ttDiscard" class="btn bad">üóëÔ∏è Discard</button></div>
</div>

<div class="card">
  <div class="h">Upload to Corpus</div>
  <div class="lab">.txt .md .jsonl accepted</div>
  <input id="upFiles" type="file" multiple/>
  <div class="row"><button id="upBtn" class="btn ok">Upload</button><span id="upMsg" class="status"></span></div>
</div>
</div>

<script>
const $ = s => document.querySelector(s);
async function api(p,o){ const r=await fetch(p,o); if(!r.ok) throw new Error(await r.text()); return r.json(); }
async function rebuild(el){ try{ await fetch('/tuner/rebuild',{method:'POST'}); el.textContent='Rebuilt.';}catch{ el.textContent='Rebuild failed.';} setTimeout(()=>el.textContent='',2000); }
async function refreshProd(){ try{ const j=await api('/semantic/reload',{method:'POST'}); $('#prodInfo').textContent=(j&&j.ok!==false&&typeof j.prod_count==='number')?`prod index: ${j.prod_count}`:'prod index: ?'; }catch{ $('#prodInfo').textContent='prod index: ?'; }}

// initial loads
(async ()=>{
  try{ const j=await api('/admin/api/voiceprint'); $('#rulesBox').value=j.text||''; $('#rulesPath').textContent=j.path||''; }catch{ $('#rulesBox').placeholder='(load error)'; }
  try{ const j=await api('/admin/api/examples_text'); $('#qaBox').value=j.text||''; }catch{ $('#qaBox').placeholder='(load error)'; }
  refreshProd();
})();

// rules
$('#rulesSave')?.addEventListener('click', async ()=>{
  const m=$('#rulesMsg'); try{ const fd=new FormData(); fd.append('text',$('#rulesBox').value); fd.append('mode','replace');
    await fetch('/admin/api/voiceprint',{method:'POST',body:fd}); m.textContent='Saved.'; await rebuild(m);}catch{ m.textContent='Error'; }
});
$('#rulesAppend')?.addEventListener('click', async ()=>{
  const m=$('#rulesMsg'); try{ const fd=new FormData(); fd.append('text',$('#rulesBox').value); fd.append('mode','append');
    await fetch('/admin/api/voiceprint',{method:'POST',body:fd}); m.textContent='Saved.'; await rebuild(m);}catch{ m.textContent='Error'; }
});

// examples
$('#qaSave')?.addEventListener('click', async ()=>{
  const m=$('#qaMsg'); try{ const fd=new FormData(); fd.append('text',$('#qaBox').value);
    const r=await fetch('/admin/api/examples_text',{method:'POST',body:fd}); m.textContent=r.ok?'Saved.':'Save error'; if(r.ok) await rebuild(m);}catch{ m.textContent='Error'; }
});
$('#qaRestore')?.addEventListener('click', async ()=>{
  const m=$('#qaMsg'); try{ const j=await api('/admin/api/examples_restore_from_prod',{method:'POST'});
    m.textContent='Restored '+j.count+' items.'; const j2=await api('/admin/api/examples_text'); $('#qaBox').value=j2.text||''; await rebuild(m);}catch{ m.textContent='Restore error'; }
});

// test & tuning
$('#ttAsk')?.addEventListener('click', async ()=>{
  const q=$('#ttPrompt').value.trim(), m=$('#ttMsg'); if(!q){ m.textContent='Enter a question'; setTimeout(()=>m.textContent='',1500); return; }
  try{ const j=await api('/retrieve',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({prompt:q})});
       $('#ttAnswer').value=(j.answer||'').trim()||'(empty)'; }catch{ m.textContent='Ask error'; setTimeout(()=>m.textContent='',1500); }
});
$('#ttAccept')?.addEventListener('click', async ()=>{
  const q=$('#ttPrompt').value.trim(), a=$('#ttAnswer').value.trim(), m=$('#ttMsg'); if(!q||!a){ m.textContent='Nothing to save'; setTimeout(()=>m.textContent='',1500); return; }
  try{ const fd=new FormData(); fd.append('title',q); fd.append('text',a);
       await fetch('/admin/api/index_text',{method:'POST',body:fd}); m.textContent='Saved.'; await rebuild(m);}catch{ m.textContent='Save error'; }
});
$('#ttDiscard')?.addEventListener('click', ()=>{ $('#ttAnswer').value=''; $('#ttMsg').textContent='Discarded'; setTimeout(()=>$('#ttMsg').textContent='',1500); });

// upload
$('#upBtn')?.addEventListener('click', async ()=>{
  const fi=document.getElementById('upFiles'), m=$('#upMsg'); if(!fi.files.length){ m.textContent='Pick files first'; setTimeout(()=>m.textContent='',2000); return; }
  const fd=new FormData(); for(const f of fi.files) fd.append('files', f);
  try{ const r=await fetch('/admin/api/upload',{method:'POST',body:fd}); m.textContent=r.ok?'Uploaded.':'Upload failed.'; }catch{ m.textContent='Upload error'; }
});

// top actions
$('#rebuildTop')?.addEventListener('click', ()=>rebuild($('#msgTop')));
$('#promoteIdx')?.addEventListener('click', async ()=>{ const m=$('#msgTop'); try{ await fetch('/semantic/promote',{method:'POST'}); await refreshProd(); m.textContent='Promoted.';}catch{ m.textContent='Promote failed'; } setTimeout(()=>m.textContent='',2000); });
</script>
</body></html>
