<!doctype html><html><head><meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<meta http-equiv="Cache-Control" content="no-store"/>
<title>Admin ‚Äî Tullman.ai</title>
<style>
:root{--bg:#0b0b0c;--ink:#e8e8ea;--muted:#a9abb3;--card:#141416;--line:#232329;--ok:#3ccf91;--bad:#ef476f;--btn:#19191c}
html,body{background:var(--bg);color:var(--ink);font:16px/1.5 system-ui,Segoe UI,Roboto,Helvetica,Arial;margin:0}
.wrap{max-width:1100px;margin:24px auto;padding:0 16px}
.h{font-weight:800;font-size:20px;margin:10px 0}
.card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:16px;margin:16px 0}
.lab{color:var(--muted);font-size:14px;margin:6px 0}
textarea,input[type=text]{width:100%;background:#0d0d0f;color:var(--ink);border:1px solid var(--line);border-radius:10px;padding:10px;font:15px/1.4 ui-monospace,Menlo,Consolas,monospace}
.btn{display:inline-block;cursor:pointer;border-radius:12px;border:1px solid #2a2a31;background:var(--btn);color:var(--ink);padding:10px 14px;font-weight:700;margin-right:8px}
.btn.ok{border-color:#1e644b;background:#0f3225}
.btn.bad{border-color:#612030;background:#2a121a}
.row{display:flex;gap:12px;flex-wrap:wrap;align-items:center;margin:8px 0}
.status{color:var(--muted);font-size:14px;margin-left:8px}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
</style></head><body><div class="wrap">
<h2>Admin ‚Äî Tullman.ai</h2>

<div class="row">
  <button id="rebuildTop" class="btn ok">üîÅ Rebuild Tuner</button>
  <button id="promoteIdx" class="btn">‚¨ÜÔ∏è Promote to Production</button>
  <span id="prodInfo" class="status">prod index: ‚Ä¶</span>
  <span id="msgTop" class="status"></span>
</div>

<div class="grid">
  <div class="card">
    <div class="h">Rules (Voiceprint)</div>
    <div class="lab">Edit staging rules. Promote when ready.</div>
    <textarea id="rulesBox" rows="12" placeholder="Voiceprint‚Ä¶">SYSTEM: Rewrite every answer in Howard Tullman‚Äôs voice.

Tone rules:
- Always first person (‚ÄúI ‚Ä¶‚Äù).
- Direct, grounded, businesslike.
- Short, declarative sentences. Cut filler.
- Never hedge. No ‚Äúas an AI,‚Äù ‚ÄúI think,‚Äù or ‚Äúmaybe.‚Äù
- Avoid generic phrases (actually, basically, honestly, hopefully, at the end of the day, journey, kind of, sort of, ultimately, you know).
- Prefer action verbs. Emphasize execution and results.

Output:
- Always a single, original Howard-style answer.
- No explanations of rules. Just the rewritten answer.

QUESTION BANK (examples of audience asks ‚Äî read for context; do not quote):
- Q: What is the most underrated human quality and why?
- Q: Hard truth about your life that you have accepted?
- Q: What does forgiveness do for you?
- Q: When did you realize you had free will?
- Q: Have you ever walked away from a comfortable corporate job?
- Q: How do you get unstuck when your mind is stuck?
- Q: What do mirrors teach you about how you see yourself versus how others see you?
- Q: What makes something unforgettable?
- Q: Why do some people cry when they‚Äôre happy?
- Q: What is real imagination, and how is it different from just appreciating what‚Äôs happening?
- Q: Who do you think has demonstrated imagination the most?
- Q: What is the difference between love and attraction?
- Q: Why can‚Äôt AI be genuinely funny yet?
- Q: Do humans truly have free will, or are we just reacting?
- Q: Have you ever had a near-death experience that changed your fear of dying?
- Q: Why do we dream, and what do dreams do for us?
- Q: What do you wish you had known at 20 about health, time, and resilience?
- Q: Is consistency overrated if it means being reliably average?
- Q: What is the best kind of feedback, and why is committed disagreement gold?
- Q: How do you define success without making it about money?
- Q: Why doesn‚Äôt time scale?
- Q: What advice would you give a driven 12-year-old about ambition and work?
- Q: What‚Äôs the real gap between IQ and EQ that smart people miss?
- Q: What is the difference between loyalty and reliability?
- Q: What single trait defines you at your core?
- Q: What do people get wrong about kindness, and why does it matter?
- Q: What‚Äôs one irrational belief you keep because it helps you move forward?
- Q: What is the meaning of life?
</textarea>
    <div class="row">
      <button id="rulesSave" class="btn ok">Save (Replace)</button>
      <button id="rulesAppend" class="btn">Save (Append)</button>
      <span id="rulesMsg" class="status"></span>
    </div>
    <div class="lab">Path: <span id="rulesPath" class="status">/home/kmages/backend/voiceprint_staging.txt</span></div>
  </div>

  <div class="card">
    <div class="h">Examples (Q&A)</div>
    <div class="lab">Blocks of <code>Q:</code> then <code>A:</code>, blank line between.</div>
    <textarea id="qaBox" rows="12" placeholder="Q: ‚Ä¶&#10;A: ‚Ä¶&#10;&#10;Q: ‚Ä¶&#10;A: ‚Ä¶">Q: What is the meaning of life?
A: I am not a rabbi, priest, politician or philosopher and I‚Äôm also always in a hurry so questions like this are not a good use of my time or yours.

Q: What is the meaning of life?
A: I am not a rabbi, priest, politician or philosopher and I‚Äôm also always in a hurry so questions like this are not a good use of my time or yours.</textarea>
    <div class="row">
      <button id="qaSave" class="btn ok">Save Q&A</button>
      <button id="qaRestore" class="btn">‚Ü©Ô∏é Restore from Prod Index</button>
      <span id="qaMsg" class="status"></span>
    </div>
  </div>
</div>

<div class="card">
  <div class="h">Test & Tuning</div>
  <input id="ttPrompt" type="text" placeholder="Ask a question‚Ä¶ (Enter to send)"/>
  <div class="row"><button id="ttAsk" class="btn ok">Ask</button><span id="ttMsg" class="status"></span></div>
  <div class="lab">System answer (editable)</div>
  <textarea id="ttAnswer" rows="8" placeholder="Answer will appear here‚Ä¶"></textarea>
  <div class="row"><button id="ttAccept" class="btn ok">‚úÖ Accept (save)</button><button id="ttDiscard" class="btn bad">üóëÔ∏è Discard</button></div>
</div>

<div class="card">
  <div class="h">Upload to Corpus</div>
  <div class="lab">.txt .md .jsonl accepted</div>
  <input id="upFiles" type="file" multiple/>
  <div class="row"><button id="upBtn" class="btn ok">Upload</button><span id="upMsg" class="status"></span></div>
</div>
</div>

<script>
// Prefill from disk (no fetch needed to display)
const VP_PREFILL = "SYSTEM: Rewrite every answer in Howard Tullman\u2019s voice.\n\nTone rules:\n- Always first person (\u201cI \u2026\u201d).\n- Direct, grounded, businesslike.\n- Short, declarative sentences. Cut filler.\n- Never hedge. No \u201cas an AI,\u201d \u201cI think,\u201d or \u201cmaybe.\u201d\n- Avoid generic phrases (actually, basically, honestly, hopefully, at the end of the day, journey, kind of, sort of, ultimately, you know).\n- Prefer action verbs. Emphasize execution and results.\n\nOutput:\n- Always a single, original Howard-style answer.\n- No explanations of rules. Just the rewritten answer.\n\nQUESTION BANK (examples of audience asks \u2014 read for context; do not quote):\n- Q: What is the most underrated human quality and why?\n- Q: Hard truth about your life that you have accepted?\n- Q: What does forgiveness do for you?\n- Q: When did you realize you had free will?\n- Q: Have you ever walked away from a comfortable corporate job?\n- Q: How do you get unstuck when your mind is stuck?\n- Q: What do mirrors teach you about how you see yourself versus how others see you?\n- Q: What makes something unforgettable?\n- Q: Why do some people cry when they\u2019re happy?\n- Q: What is real imagination, and how is it different from just appreciating what\u2019s happening?\n- Q: Who do you think has demonstrated imagination the most?\n- Q: What is the difference between love and attraction?\n- Q: Why can\u2019t AI be genuinely funny yet?\n- Q: Do humans truly have free will, or are we just reacting?\n- Q: Have you ever had a near-death experience that changed your fear of dying?\n- Q: Why do we dream, and what do dreams do for us?\n- Q: What do you wish you had known at 20 about health, time, and resilience?\n- Q: Is consistency overrated if it means being reliably average?\n- Q: What is the best kind of feedback, and why is committed disagreement gold?\n- Q: How do you define success without making it about money?\n- Q: Why doesn\u2019t time scale?\n- Q: What advice would you give a driven 12-year-old about ambition and work?\n- Q: What\u2019s the real gap between IQ and EQ that smart people miss?\n- Q: What is the difference between loyalty and reliability?\n- Q: What single trait defines you at your core?\n- Q: What do people get wrong about kindness, and why does it matter?\n- Q: What\u2019s one irrational belief you keep because it helps you move forward?\n- Q: What is the meaning of life?";
const QA_PREFILL = "Q: What is the meaning of life?\nA: I am not a rabbi, priest, politician or philosopher and I\u2019m also always in a hurry so questions like this are not a good use of my time or yours.\n\nQ: What is the meaning of life?\nA: I am not a rabbi, priest, politician or philosopher and I\u2019m also always in a hurry so questions like this are not a good use of my time or yours.";
(function(){
  const rb=document.getElementById('rulesBox'); if(rb) rb.value = VP_PREFILL || '';
  const qb=document.getElementById('qaBox');    if(qb) qb.value = QA_PREFILL || '';
})();

// Helpers
const $ = s => document.querySelector(s);
async function api(p,o){ const r=await fetch(p,o); if(!r.ok) throw new Error(await r.text()); return r.json(); }
async function rebuild(el){ try{ await fetch('/tuner/rebuild',{method:'POST'}); el.textContent='Rebuilt.';}catch{ el.textContent='Rebuild failed.';} setTimeout(()=>el.textContent='',2000); }
async function refreshProd(){ try{ const j=await api('/semantic/reload',{method:'POST'}); $('#prodInfo').textContent=(j&&j.ok!==false&&typeof j.prod_count==='number')?`prod index: ${j.prod_count}`:'prod index: ?'; }catch{ $('#prodInfo').textContent='prod index: ?'; }}

// Only prod count needs live fetch
refreshProd();

// Rules saves (POST to API)
$('#rulesSave')?.addEventListener('click', async ()=>{
  const m=$('#rulesMsg'); try{ const fd=new FormData(); fd.append('text',$('#rulesBox').value); fd.append('mode','replace');
    await fetch('/admin/api/voiceprint',{method:'POST',body:fd}); m.textContent='Saved.'; await rebuild(m);}catch{ m.textContent='Error'; }
});
$('#rulesAppend')?.addEventListener('click', async ()=>{
  const m=$('#rulesMsg'); try{ const fd=new FormData(); fd.append('text',$('#rulesBox').value); fd.append('mode','append');
    await fetch('/admin/api/voiceprint',{method:'POST',body:fd}); m.textContent='Saved.'; await rebuild(m);}catch{ m.textContent='Error'; }
});

// Q&A saves/restores
$('#qaSave')?.addEventListener('click', async ()=>{
  const m=$('#qaMsg'); try{ const fd=new FormData(); fd.append('text',$('#qaBox').value);
    const r=await fetch('/admin/api/examples_text',{method:'POST',body:fd}); m.textContent=r.ok?'Saved.':'Save error'; if(r.ok) await rebuild(m);}catch{ m.textContent='Error'; }
});
$('#qaRestore')?.addEventListener('click', async ()=>{
  const m=$('#qaMsg'); try{ const j=await api('/admin/api/examples_restore_from_prod',{method:'POST'});
    m.textContent='Restored '+j.count+' items.'; const j2=await api('/admin/api/examples_text'); $('#qaBox').value=j2.text||''; await rebuild(m);}catch{ m.textContent='Restore error'; }
});

// Test & Tuning
$('#ttAsk')?.addEventListener('click', async ()=>{
  const q=$('#ttPrompt').value.trim(), m=$('#ttMsg'); if(!q){m.textContent='Enter a question'; setTimeout(()=>m.textContent='',1500); return;}
  try{ const j=await api('/retrieve',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({prompt:q})});
       $('#ttAnswer').value=(j.answer||'').trim()||'(empty)'; }catch{ m.textContent='Ask error'; setTimeout(()=>m.textContent='',1500); }
});
$('#ttAccept')?.addEventListener('click', async ()=>{
  const q=$('#ttPrompt').value.trim(), a=$('#ttAnswer').value.trim(), m=$('#ttMsg'); if(!q||!a){m.textContent='Nothing to save'; setTimeout(()=>m.textContent='',1500); return;}
  try{ const fd=new FormData(); fd.append('title',q); fd.append('text',a); await fetch('/admin/api/index_text',{method:'POST',body:fd}); m.textContent='Saved.'; await rebuild(m);}catch{ m.textContent='Save error'; }
});
$('#ttDiscard')?.addEventListener('click', ()=>{ $('#ttAnswer').value=''; $('#ttMsg').textContent='Discarded'; setTimeout(()=>$('#ttMsg').textContent='',1500); });

// Upload
$('#upBtn')?.addEventListener('click', async ()=>{
  const fi=document.getElementById('upFiles'), m=$('#upMsg'); if(!fi.files.length){ m.textContent='Pick files first'; setTimeout(()=>m.textContent='',2000); return; }
  const fd=new FormData(); for(const f of fi.files) fd.append('files', f);
  try{ const r=await fetch('/admin/api/upload',{method:'POST',body:fd}); m.textContent=r.ok?'Uploaded.':'Upload failed.'; }catch{ m.textContent='Upload error'; }
});

// Promote
$('#promoteIdx')?.addEventListener('click', async ()=>{ const m=$('#msgTop'); try{ await fetch('/semantic/promote',{method:'POST'}); await refreshProd(); m.textContent='Promoted.';}catch{m.textContent='Promote failed';} setTimeout(()=>m.textContent='',2000); });
</script>
</body></html>
